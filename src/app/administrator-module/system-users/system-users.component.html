<div class="content-block">
  <h4 class="header_title mb-3 p-2">System Users Management.</h4>
  <div class="dx-card responsive-paddings">
    <dx-data-grid (onRowClick)="previewDetails($event, 'User')" (onToolbarPreparing)="onParamsToolBarPreparing($event)"
      [allowColumnResizing]="true" [columnAutoWidth]="true" [columnHidingEnabled]="false" [dataSource]="paramDataSet"
      [focusedRowEnabled]="true" [showBorders]="true" [showRowLines]="true" height="funcpopHeigt(datagridHeight)"
      keyExpr="id">

      <dxo-search-panel [visible]="true">
      </dxo-search-panel>
      <dxo-paging [pageSize]="20"></dxo-paging>
      <dxo-pager [allowedPageSizes]="[20, 50, 100]" [showPageSizeSelector]="true"></dxo-pager>
      <dxo-filter-row [visible]="false"></dxo-filter-row>
      <dxo-export [allowExportSelectedData]="true" [enabled]="true" fileName="Active Users"></dxo-export>
      <dxo-selection mode="single"></dxo-selection>
      <dxo-header-filter [visible]="true"></dxo-header-filter>
      <dxo-filter-panel [visible]="true"></dxo-filter-panel>

      <dxi-column caption="ID" dataField="id"></dxi-column>
      <dxi-column caption="System ID" dataField="systemId"></dxi-column>
      <dxi-column caption="Link ID" dataField="linkId"></dxi-column>
      <dxi-column dataField="userGroup"></dxi-column>
      <dxi-column dataField="username"></dxi-column>
      <dxi-column caption="Middle Name" dataField="middleName">
      </dxi-column>
      <dxi-column caption="Last Name" dataField="lastName">
      </dxi-column>
      <dxi-column dataField="mobileNo"></dxi-column>
      <dxi-column caption="Email" dataField="email">
      </dxi-column>
      <dxi-column dataField="designation">
      </dxi-column>
      <dxi-column dataField="accountName">
      </dxi-column>
      <dxi-column  dataField="createdAt" dataType="date" format="yyyy-mm-dd hh:mm:ss a">
      </dxi-column>
      <dxi-column [width]="90" caption="Status" cellTemplate="cellTemplateEnabled" dataField="status" dataType="string">
        <div *dxTemplate="let d of 'cellTemplateEnabled'">
          <div *ngIf="d.data.status == 1" class="text-center">
            <span class="text-white bg-success rounded pl-2 pr-2">Enabled</span>
          </div>
          <div *ngIf="d.data.status != 1" class="text-center">
            <span class="text-white bg-danger rounded pl-2 pr-2">Disabled</span>
          </div>
        </div>
      </dxi-column>


      <dxi-column dataField="userGroupId"></dxi-column>
      <dxi-column dataField="userGroupDesc"></dxi-column>
      <dxi-column dataField="userGroupCatId"></dxi-column>
      <dxi-column dataField="userGroupCatName"></dxi-column>
      <dxi-column dataField="userGroupCatDesc"></dxi-column>


    </dx-data-grid>
  </div>
</div>

<dx-popup [(visible)]="paramswinpnl" [closeOnOutsideClick]="false" [dragEnabled]="false" [height]="funcpopHeigt(90)"
  [showTitle]="true" [width]="funcpopWidth(80)" class="popup" title="User Details">

  <div *dxTemplate="let data of 'content'">
    <dx-scroll-view>
      <form (submit)="onSubmitUserRegDetails()" [formGroup]="paramwinfrm">
        <div class="row">
          <div class="col-12">
            <div class="card">
              <div class="card-body">
                <fieldset>
                  <div class="container-fluid">
                    <div class="row">
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Link ID</label>
                        <dx-text-box formControlName="linkId">
                        </dx-text-box>
                      </div>
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Designation*</label>
                        <dx-text-box formControlName="designation">
                        </dx-text-box>
                      </div>
                    </div>

                    <div class="row">
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Account Name*</label>
                        <dx-text-box formControlName="accountName">
                        </dx-text-box>
                      </div>
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Registration Type*</label>
                        <dx-select-box
                        formControlName="userGroup"
                        [dataSource]="rolesList"
                        displayExpr="description"
                        valueExpr="userGroup">
                      </dx-select-box>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">First Name*</label>
                        <dx-text-box formControlName="firstName">
                          <dx-validator>
                            <dxi-validation-rule message="First Name is required" type="required"></dxi-validation-rule>
                            <dxi-validation-rule [pattern]="namePattern" message="Do not use digits in the Name"
                              type="pattern">
                            </dxi-validation-rule>
                            <dxi-validation-rule [min]="2" message="Name must have at least 2 characters" type="stringLength">
                            </dxi-validation-rule>
                          </dx-validator>
                        </dx-text-box>
                      </div>
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Mobile Number*</label>
                        <div class="d-flex">
                          <dx-text-box width="100%" formControlName="mobileNo">
                            <dx-validator>
                              <dxi-validation-rule message="Mobile number is required" type="required"></dxi-validation-rule>
                              <dxi-validation-rule [max]="16" [min]="7" message="Please enter a correct phone format"
                                type="stringLength"></dxi-validation-rule>
                            </dx-validator>
                          </dx-text-box>
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Middle Name*</label>
                        <dx-text-box formControlName="middleName">
                          <dx-validator>
                            <dxi-validation-rule message="Middle Name is required" type="required"></dxi-validation-rule>
                            <dxi-validation-rule [pattern]="namePattern" message="Do not use digits in the Name"
                              type="pattern">
                            </dxi-validation-rule>
                            <dxi-validation-rule [min]="2" message="Name must have at least 2 characters" type="stringLength">
                            </dxi-validation-rule>
                          </dx-validator>
                        </dx-text-box>
                      </div>
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Telephone Number</label>
                        <dx-text-box formControlName="telephoneNo">
                        </dx-text-box>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Last Name*</label>
                        <dx-text-box formControlName="lastName">
                          <dx-validator>
                            <dxi-validation-rule message="Last Name is required" type="required"></dxi-validation-rule>
                            <dxi-validation-rule [pattern]="namePattern" message="Do not use digits in the Name"
                              type="pattern">
                            </dxi-validation-rule>
                            <dxi-validation-rule [min]="2" message="Name must have at least 2 characters" type="stringLength">
                            </dxi-validation-rule>
                          </dx-validator>
                        </dx-text-box>
                      </div>
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Email Address*</label>
                        <dx-text-box formControlName="email">
                          <dx-validator>
                            <dxi-validation-rule message="Email is required" type="required"></dxi-validation-rule>
                            <dxi-validation-rule message="Email is invalid" type="email"></dxi-validation-rule>
                          </dx-validator>
                        </dx-text-box>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12 col-md-6 col-lg-6">
                        <label class="text-muted">Username*</label>
                        <dx-text-box formControlName="username">
                          <dx-validator>
                            <dxi-validation-rule message="username is required" type="required"></dxi-validation-rule>
                          </dx-validator>
                        </dx-text-box>
                      </div>
                      <div class="col-12 col-md-6 col-lg-6"></div>
                    </div>
                  </div>
                </fieldset>

                <div class="btn col-12" *ngIf="hideUserDetailsControls">
                  <dx-button class="button" stylingMode="contained" text="Register New User" type="default"
                    (onClick)="onSubmitAccountForm()">
                  </dx-button>
                </div>
                <div class="row d-flex justify-content-center" *ngIf="!hideUserDetailsControls">

                  <div class="btn col-4">
                    <dx-button text="Update User" icon="edit" class="button" stylingMode="contained" type="default" (onClick)="updateUser(currentData)">
                    </dx-button>
                  </div>

                  <div class="btn col-4" *ngIf="!hideEnableBtn">
                    <dx-button text="Enable User" icon="fa fa-unlock" class="button" stylingMode="contained" type="default" (onClick)="disableEnableUser(currentData, '1')">
                    </dx-button>
                  </div>

                  <div class="btn col-4">
                    <dx-button text="User Reset" icon="fa fa-retweet" class="button" stylingMode="contained" type="default" (onClick)="onUserResetHandler(currentData)">
                    </dx-button>
                  </div>

                  <div class="btn col-4" *ngIf="!hideDisableBtn">
                    <dx-button text="Disable User" icon="fa fa-lock" class="button" stylingMode="contained"
                      type="danger" (onClick)="disableEnableUser(currentData, '2')"></dx-button>
                  </div>
                </div>
              </div>
            </div>
          </div>
          </div>
      </form>
    </dx-scroll-view>
  </div>
</dx-popup>



<dx-popup class="popup" [width]="funcpopWidth(30)" [height]="funcpopHeigt(50)" [showTitle]="true"
[dragEnabled]="false" [closeOnOutsideClick]="false" [(visible)]="showAlertDialog"  title="Info">

<div *dxTemplate="let data of 'content'">
  <dx-scroll-view>
    <div>
      <h1 class="text-center">
        <i class="fa fa-check-circle fa-3x text-success"></i>
      </h1>
      <h3 class="text-center">{{alertDialogMessage}}</h3>
        <!-- <dx-button
        class="text-center"
        text="Close"
        type="default"
        (onClick)="closeAlertDialog()">
        </dx-button> -->
    </div>
  </dx-scroll-view>
</div>
</dx-popup>
