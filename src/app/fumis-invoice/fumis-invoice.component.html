<div class="content-block row">
  <div class="col">
    <div class="card card_border">
      <div class="card-header card_header_background">
        {{ title }}
      </div>
      <div class="card-body card-nopadding">

        <form [formGroup]="searchForm">

          <div class="row p-3">
            <div class="col-12 col-md-3">
            </div>

            <div class="col-12 col-md-3">
              <label for="invoiceRef">Invoice ID/Invoice Number</label>
              <dx-text-box id="invoiceRef" formControlName="invoiceRef" placeholder="Enter Invoice ID or Invoice Number">
              </dx-text-box>
            </div>

            <div class="col-12 col-md-3">
              <div>&nbsp;</div>
              <dx-button
              id="action"
              text="Search Record"
              type="default"
              [useSubmitBehavior]="false"
              (click)="fetchDetails()">
              </dx-button>
            </div>
          </div>
        </form>

        <table class="table table-striped table-bordered table-inverse table-responsive mb-3">
          <thead class="thead-inverse">
            <tr>
              <th>Invoice No</th>
              <th>Inv Type</th>
              <th>Employer No</th>
              <th>Employer No</th>
              <th>Employer Name</th>
              <th>Currency</th>
              <th>Invoice Amount</th>
              <th>Amount Paid</th>
              <th>Branch Code</th>
              <th>Pay Status</th>
              <th>Creation Date</th>
              <th>Created By</th>
              <th>Invoice Desc</th>
            </tr>
            </thead>
            <tbody>
              <tr>
                <td>{{fumisDetails.invoiceNo}}</td>
                <td>{{fumisDetails.invType}}</td>
                <td>{{fumisDetails.employerNo}}</td>
                <td>{{fumisDetails.employerNo}}</td>
                <td>{{fumisDetails.employerName}}</td>
                <td>{{fumisDetails.currencyCode}}</td>
                <td>{{fumisDetails.invoiceAmount | currency: 'USD':''}}</td>
                <td>{{fumisDetails.amountPaid | currency: 'USD':''}}</td>
                <td>{{fumisDetails.branchCode}}</td>
                <td>{{fumisDetails.payStatus}}</td>
                <td>{{fumisDetails.creationDate}}</td>
                <td>{{fumisDetails.createdBy}}</td>
                <td>{{fumisDetails.invoiceDesc}}</td>
              </tr>
            </tbody>
        </table>

        <table class="table table-striped table-inverse table-responsive mb-3">
          <thead class="thead-inverse">
            <tr>
              <th *ngIf="showGenerateControls">Generate Control Number</th>
              <th *ngIf="showPrintControls">Print Order Form</th>
            </tr>
            </thead>
            <tbody>
              <tr>
                <td *ngIf="showGenerateControls">
                  <dx-button
                    text="Generate"
                    icon="fa fa-paper-plane"
                    type="default"
                    (click)="seal()">
                 </dx-button>
                </td>
                <td *ngIf="showPrintControls">
                  <dx-button
                    text="Print"
                    icon="fa fa-print"
                    type="default"
                    (click)="printInvoiceReceipt()">
                 </dx-button>
                </td>
              </tr>
            </tbody>
        </table>


        <hr>
        <p>Contribution List</p>
        <hr>
        <div  *ngIf="showGenerateControls">
          <dx-data-grid
          keyExpr="id"
          [height]="funcpopHeigt(50)"
          [dataSource]="contributionDatasource"
          [showBorders]="false"
          [focusedRowEnabled]="false"
          [columnAutoWidth]="true"
          [showRowLines]="true"
          [allowColumnResizing]="true"
          [columnHidingEnabled]="false">
          <dxo-search-panel [visible]="true"> </dxo-search-panel>
          <dxo-paging [enabled]="false"></dxo-paging>
          <dxo-filter-row [visible]="false"></dxo-filter-row>
          <dxo-export [enabled]="true" fileName="Contribution List" [allowExportSelectedData]="true">
          </dxo-export>
          <dxo-selection mode="single"></dxo-selection>
          <dxo-header-filter [visible]="false"></dxo-header-filter>
          <dxo-filter-panel [visible]="false"></dxo-filter-panel>
          <!-- <dxo-scrolling mode="virtual" columnRenderingMode="virtual"></dxo-scrolling> -->

          <dxi-column dataField="createdAt" caption="Created At" dataType="date" format="yyyy-MM-dd HH:mm:ss a" sortOder="desc"></dxi-column>
          <dxi-column dataField="contPeriod" caption="Contribution Period"></dxi-column>
          <dxi-column dataField="amount" dataType="number">
            <dxo-format type="fixedPoint" [precision]="2"> </dxo-format>
          </dxi-column>
          <dxi-column dataField="paid" dataType="number">
            <dxo-format type="fixedPoint" [precision]="2"> </dxo-format>
          </dxi-column>

          <dxi-column dataField="createdBy"></dxi-column>
          <dxi-column dataField="remarks"></dxi-column>


        <!-- SUMMARY -->

        <dxo-summary [recalculateWhileEditing]="true">
          <dxi-total-item
              column="createdAt"
              summaryType="count"
              valueFormat="fixedPoint">
          </dxi-total-item>

          <dxi-total-item
          column="amount"
          summaryType="sum"
          valueFormat="fixedPoint"
          precision="2">
      </dxi-total-item>


      </dxo-summary>

        </dx-data-grid>
        </div>

        <hr>
        <p>Penalty List</p>
        <hr>

        <div  *ngIf="showGenerateControls">
          <dx-data-grid
          keyExpr="id"
          [height]="funcpopHeigt(50)"
          [dataSource]="penaltyDatasource"
          [showBorders]="false"
          [focusedRowEnabled]="false"
          [columnAutoWidth]="true"
          [showRowLines]="true"
          [allowColumnResizing]="true"
          [columnHidingEnabled]="false">
          <dxo-search-panel [visible]="true"> </dxo-search-panel>
          <dxo-paging [enabled]="false"></dxo-paging>
          <dxo-filter-row [visible]="false"></dxo-filter-row>
          <dxo-export [enabled]="true" fileName="Penalty List" [allowExportSelectedData]="true">
          </dxo-export>
          <dxo-selection mode="single"></dxo-selection>
          <dxo-header-filter [visible]="false"></dxo-header-filter>
          <dxo-filter-panel [visible]="false"></dxo-filter-panel>
          <!-- <dxo-scrolling mode="virtual" columnRenderingMode="virtual"></dxo-scrolling> -->

          <dxi-column dataField="createdAt" dataType="date" format="yyyy-MM-dd hh:mm:ss a" sortOder="desc"></dxi-column>
          <dxi-column dataField="penNo" caption="Penalty Number"></dxi-column>
          <dxi-column dataField="penInvNo" caption="Invoice Number"></dxi-column>
          <dxi-column dataField="penInvCtrlNo" caption="Control Number"></dxi-column>
          <dxi-column dataField="ogInvNo" caption="Org Inv. Number"></dxi-column>
          <dxi-column dataField="ogCtrlNo" caption="Org Inv Number"></dxi-column>
          <dxi-column dataField="empNo" caption="Employer Number"></dxi-column>
          <dxi-column dataField="empName" caption="Employer Receipt"></dxi-column>

          <dxi-column dataField="paymentStatus"></dxi-column>
          <dxi-column dataField="penDesc" caption="Description"></dxi-column>
          <dxi-column dataField="penPercent" caption="Penalty Percent"></dxi-column>
          <dxi-column dataField="createdBy"></dxi-column>


        <!-- SUMMARY -->

        <dxo-summary [recalculateWhileEditing]="true">
          <dxi-total-item
              column="createdAt"
              summaryType="count"
              valueFormat="fixedPoint">
          </dxi-total-item>
      </dxo-summary>

        </dx-data-grid>
        </div>

      </div>
    </div>
  </div>
</div>

<div class="container">
  <dx-scroll-view>
    <div id="print-container2" class="invoice_wrapper" style="display: none">
      <div class="invoice">
        <div class="logo__block">
          <img src="./assets/img/zssf.png" alt="zssf logo" style="width: 70px; height: 70px;" />
          <p>Zanzibar Social Security Fund</p>
          <p>Order Form</p>
        </div>
        <div class="invoice__head row">
          <div class="invoice__head__child col-12 col-md-6">
            <table class="table table-responsive">
              <tbody>
                <tr>
                  <td>Control Number: </td>
                  <td><strong>{{controlNumber}}</strong> </td>
                </tr>
                <tr>
                  <td>Total Amount: </td>
                  <td><strong>{{amount | currency:'USD':'' }} {{currency}}</strong></td>
                </tr>
                <tr>
                  <td>Date:</td>
                  <td><strong>{{now | date: "yyyy - MM -d h:mm:ss a"}}</strong></td>
                </tr>
                <tr>
                  <td>Customer Number: </td>
                  <td><strong>{{customerNumber}}</strong></td>
                </tr>

                <tr>
                  <td>Payer Name: </td>
                  <td><strong>{{payerName}}</strong></td>
                </tr>

              </tbody>
            </table>
          </div>
          <div class="invoice__head__child_contacts col-12 col-md-6 text-right">
            <div *ngIf="!hideQrCode">
              <!-- place the actual qr code here -->
              <qrcode [level]="1" [qrvalue]="qrCodeString"></qrcode>
            </div>
          </div>
        </div>
        <p
          style="text-align: center; border-bottom: 1px dotted #4d88bb; border-top: 1px dotted #4d88bb; padding: .5rem;">
          Bill Details</p>
          <div class="divide">
            <div class="invoice__body">
              <table class="full_table table">
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Description</th>
                    <th>Currency</th>
                    <th style="text-align: end;">Amount</th>
                  </tr>
                </thead>
                <tbody>

                  <!-- individualBillDescription -->
                  <!-- hideViewControls -->
                  <tr *ngFor="let item of invoiceBillItems">
                    <td>{{item.itemId}}</td>
                    <td>{{item.itemDesc}}</td>
                     <td>
                      <p style="text-align: end; color: #000;">
                        {{item.itemAmount | currency:'USD':''}}
                      </p>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <!-- HOW TO PAY INSTRUCTIONS -->
            <div class="invoice__how_to_pay row">
              <div class="col-12 col-md-6">
                <hr>
                <table class="table table-responsive">
                  <tbody>
                    <tr>
                      <td colspan="2">Jinsi ya Kulipa</td>
                    </tr>
                    <tr>
                      <td colspan="2">1. Kupitia Benki: Fika tawi lolote
                        au wakala wa benki ya CRDB, PBZ, NMB. Namba ya kumbukumbu: <strong>{{controlNumber}}</strong>
                      </td>
                      <td colspan="2">NB: Kupitia Benki CRDB: Fika tawi lolote
                        ,wakala wa benki ya CRDB au kutumia Simbanking (USSD & Mobile App) . Namba ya kumbukumbu: <strong>ZS{{controlNumber}}</strong>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
              <div class="col-12 col-md-6">
                <hr>
                <table class="table table-responsive">
                  <tbody>
                    <tr>
                      <td colspan="2">How to Pay</td>
                    </tr>
                    <tr>
                      <td colspan="2">Via Bank: Visit any branch or bank agent of CRDB, PBZ, NMB.
                        Reference Number: <strong>{{controlNumber}}</strong>
                      </td>
                      <td colspan="2">NB: Through CRDB Bank: Visit at any branch
                        ,CRDB banking agent or using Simbanking (USSD & Mobile App). Reference number: <strong>ZS{{controlNumber}}</strong>
                      </td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>
        <hr>
        <p class="footer">Zanzibar Social Security Find &copy; {{currentYear}} All Rights Reserved (ZSSF)</p>
      </div>
    </div>
  </dx-scroll-view>
</div>
